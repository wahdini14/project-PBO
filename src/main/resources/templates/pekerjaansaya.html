<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pekerjaan Saya</title>
    <link rel="stylesheet" th:href="@{/css/pekerjaansayastyle.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>
<body>
<div class="container">

    <!-- Sidebar -->
    <aside>
        <div class="top">
            <div class="logo">
                <h2>Kerja<span class="danger">Kilat</span></h2>
            </div>
        </div>

        <div class="sidebar">
            <a th:href="@{/dashboard}">
                <span class="material-symbols-sharp">grid_view</span>
                <h3>Dashboard</h3>
            </a>

            <a th:href="@{/tambahpekerjaan}">
                <span class="material-symbols-sharp">add_notes</span>
                <h3>Tambahkan Pekerjaan</h3>
            </a>

            <a th:href="@{/pekerjaansaya}" class="active">
                <span class="material-symbols-sharp">work</span>
                <h3>Pekerjaan Saya</h3>
                    <span th:if="${acceptedNotifications != null and acceptedNotifications > 0}" class="notif-badge" th:text="${acceptedNotifications}"></span>
            </a>

            <a th:href="@{/message}">
                <span class="material-symbols-sharp">message</span>
                <h3>Pesan</h3>
            </a>

            <a th:href="@{/profile}">
                <span class="material-symbols-sharp">account_circle</span>
                <h3>Profil</h3>
            </a>

            <a href="javascript:void(0)" onclick="openLogoutPopup()">
                <span class="material-symbols-sharp">logout</span>
                <h3>Keluar</h3>
            </a>
        </div>
    </aside>

    <!-- Main -->
    <main class="content">
        <h1>Riwayat Pekerjaan</h1>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-target="tab-dilamar">Dilamar</button>
            <button class="tab" data-target="tab-diterima">Diterima</button>
            <button class="tab" data-target="tab-selesai">Selesai</button>
        </div>

        <!-- Panel Dilamar -->
        <div class="job-list" id="tab-dilamar">
            <div th:each="app : ${dilamarList}" class="job-card">
                <h3 th:text="${app.job.title}"></h3>
                <p th:text="${app.job.location}"></p>
                <button class="detail-btn"
                        th:onclick="'location.href=\'/job/' + ${app.job.id} + '\';'">
                    Lihat detail
                </button>
            </div>
        </div>

        <!-- Panel Diterima -->
        <div class="job-list" id="tab-diterima" style="display:none">
            <div th:each="app : ${diterimaList}" class="job-card">
                <h3 th:text="${app.job.title}"></h3>
                <p th:text="${app.job.location}"></p>
                <button class="detail-btn"
                        th:onclick="'location.href=\'/job/' + ${app.job.id} + '\';'">
                    Lihat detail
                </button>
                <form th:action="@{/pekerjaansaya/{appId}/finish(appId=${app.id})}" method="post" style="display:inline; margin-left:8px;">
                    <button type="submit" class="detail-btn">Tandai Telah Selesai</button>
                </form>
            </div>
        </div>

        <!-- Panel Selesai -->
        <div class="job-list" id="tab-selesai" style="display:none">
            <div th:each="app : ${selesaiList}" class="job-card">
                <h3 th:text="${app.job.title}"></h3>
                <p th:text="${app.job.location}"></p>
                <button class="detail-btn"
                        th:onclick="'location.href=\'/job/' + ${app.job.id} + '\';'">
                    Lihat detail
                </button>
            </div>
        </div>

    </main>
</div>

<!-- LOGOUT CONFIRMATION POPUP -->
<div class="logout-overlay" id="logoutPopup" style="display: none;">
    <div class="logout-box">
        <h3>Apa kamu yakin ingin keluar?</h3>

        <div class="logout-actions">
            <button class="btn-yes" onclick="confirmLogout()">Ya</button>
            <button class="btn-no" onclick="closeLogoutPopup()">Tidak</button>
        </div>
    </div>
</div>

<script>
// TAB FUNCTION FIXED
const tabButtons = document.querySelectorAll(".tab");

tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {

        // remove active
        tabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        // hide all
        document.querySelectorAll(".job-list").forEach(list => {
            list.style.display = "none";
        });

        // show selected
        const target = btn.getAttribute("data-target");
        document.getElementById(target).style.display = "block";
    });
});

function openLogoutPopup() {
    document.getElementById("logoutPopup").style.display = "flex";
}
function closeLogoutPopup() {
    document.getElementById("logoutPopup").style.display = "none";
}
function confirmLogout() {
    window.location.href = "/logout";
}
</script>

</body>
</html>

<!-- 
    pekerjaansaya.html (Template View)
    Tanggung Jawab: Menampilkan riwayat aplikasi pekerjaan yang user lamar, dengan filter status: Dilamar, Diterima, Selesai.
    Komponen Utama:
    - Sidebar navigasi (sama seperti dashboard).
    - Tab buttons untuk filter: "Dilamar" (APPLIED), "Diterima" (ACCEPTED), "Selesai" (FINISHED).
    - Job card untuk setiap aplikasi yang menampilkan: job title, location, tombol "Lihat detail".
    - Tab "Diterima" memiliki tombol tambahan "Tandai Telah Selesai" untuk mark aplikasi sebagai FINISHED.
    Fitur:
    - Tab switching menggunakan JavaScript (client-side toggle tanpa reload).
    - "Lihat detail" → redirect ke /job/{jobId} untuk lihat full job detail.
    - "Tandai Telah Selesai" → POST ke /pekerjaansaya/{appId}/finish untuk update status ke FINISHED.
    - Logout confirmation popup.
    Data dari Controller:
    - dilamarList: JobApplication dengan status APPLIED.
    - diterimaList: JobApplication dengan status ACCEPTED.
    - selesaiList: JobApplication dengan status FINISHED.
    SOLID Principles:
    - Single Responsibility: Template fokus pada presentasi riwayat aplikasi dan tab UI, business logic di JobApplicationController.
    - Separation of Concerns: Tab logic di JavaScript, data filtering di backend.
-->

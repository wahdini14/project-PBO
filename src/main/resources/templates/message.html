<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesan</title>
    <link rel="stylesheet" th:href="@{/css/messagestyle.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>
<body>
    <aside>
        <div class="top">
            <div class="logo">
                <h2>Kerja<span class="danger">Kilat</span></h2>
            </div>
        </div>

        <div class="sidebar">
            <a th:href="@{/dashboard}"><span class="material-symbols-sharp"> grid_view </span><h3>Dashboard</h3></a>
            <a th:href="@{/tambahpekerjaan}"><span class="material-symbols-sharp"> add_notes </span><h3>Tambahkan Pekerjaan</h3></a>
            <a th:href="@{/pekerjaansaya}"><span class="material-symbols-sharp"> work </span><h3>Pekerjaan Saya</h3>
                <span th:if="${acceptedNotifications != null and acceptedNotifications > 0}" class="notif-badge" th:text="${acceptedNotifications}"></span>
            </a>
            <a th:href="@{/message}" class="active"><span class="material-symbols-sharp"> message </span><h3>Pesan</h3>
            </a>
            <a th:href="@{/profile}"><span class="material-symbols-sharp"> account_circle </span><h3>Profil</h3></a>
            <a href="javascript:void(0)" onclick="openLogoutPopup()"><span class="material-symbols-sharp"> logout </span><h3>Keluar</h3>
</a>

        </div>
    </aside>

    <main class="messages-container">
        <!-- LEFT: conversation list -->
        <div class="conversation-list">
            <h2>Pesan</h2>
            <div class="conversations">
                <a th:each="conv : ${conversations}" th:href="@{'/message/' + ${conv.id}}" class="conversation-item">
                    <div class="conv-user">
                        <div class="avatar"><span class="material-symbols-sharp"> account_circle </span></div>
                        <div class="conv-info">
                            <h4 th:text="${conv.otherUser.username}">Nama User</h4>
                            <p th:text="${conv.lastMessage}">Pesan terakhir...</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- RIGHT: chat area -->
        <div class="chat-area" th:if="${selectedConversation != null}">
            <div class="chat-header">
                <h3 th:text="${selectedConversation.otherUser.username}">Nama User</h3>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div th:each="msg : ${messages}" 
                     th:classappend="${msg.senderId == session.userId} ? ' message me' : ' message other'">
                    <p th:text="${msg.content}"></p>
                    <small th:text="${msg.sentAt}"></small>
                </div>
            </div>

            <form class="chat-input" th:action="@{'/message/send/' + ${selectedConversation.id}}" method="post">
                <input type="text" name="content" placeholder="Ketik pesan..." required>
                <button type="submit"><span class="material-symbols-sharp"> send </span></button>
            </form>
        </div>

        <!-- jika belum memilih percakapan -->
        <div class="chat-area empty" th:if="${selectedConversation == null}">
            <p>Pilih percakapan untuk mulai mengirim pesan.</p>
        </div>
    </main>
    <!-- LOGOUT CONFIRMATION POPUP -->
    <div class="logout-overlay" id="logoutPopup" style="display: none;">
        <div class="logout-box">
            <h3>Apa kamu yakin ingin keluar?</h3>

            <div class="logout-actions">
                <button class="btn-yes" onclick="confirmLogout()">Ya</button>
                <button class="btn-no" onclick="closeLogoutPopup()">Tidak</button>
            </div>
        </div>
    </div>

<script>
    function openLogoutPopup() {
        document.getElementById("logoutPopup").style.display = "flex";
    }
    function closeLogoutPopup() {
        document.getElementById("logoutPopup").style.display = "none";
    }
    function confirmLogout() {
        window.location.href = "/logout";
    }
</script>
</body>
</html>

<!-- 
    message.html (Template View)
    Tanggung Jawab: Menampilkan halaman messaging (chat) dengan conversation list di sebelah kiri dan chat area di sebelah kanan.
    Komponen Utama:
    - Sidebar navigasi (sama seperti dashboard).
    - LEFT: Conversation list menampilkan semua conversation user, diurutkan terbaru terlebih dahulu.
      Setiap item menampilkan: avatar, username otherUser, pesan terakhir (lastMessage).
    - RIGHT: Chat area menampilkan pesan dalam conversation terpilih, diurutkan kronologis (lama → baru).
      Input box untuk mengirim pesan baru.
    - Empty state jika user belum memilih conversation.
    - Logout confirmation popup.
    Fitur:
    - Click conversation item → redirect ke /message/{conversationId} untuk load conversation terpilih.
    - Form POST ke /message/send/{conversationId} untuk submit pesan baru.
    - Responsive UI: conversation list di kiri, chat di kanan.
    Notifikasi:
    - Badge acceptedNotifications pada "Pekerjaan Saya" (sama seperti halaman lain).
    SOLID Principles:
    - Single Responsibility: Template fokus pada presentasi messaging UI, business logic di ChatController & MessageService.
    - Separation of Concerns: Conversation list logic di backend (ConversationService), chat input adalah simple form POST.
-->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${job.title}">Detail Pekerjaan</title>
    <link rel="stylesheet" th:href="@{/css/jobdetailstyle.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp" />
</head>
<body>
    <div class="container">
        <!-- Sidebar sec start -->
         <aside>
            <div class="top">
                <div class="logo">
                    <h2>Kerja<span class="danger">Kilat</span></h2>
                </div>
            </div>
            <!-- end top -->

            <div class="sidebar">
                <a th:href="@{/dashboard}" class="active">
                    <span class="material-symbols-sharp"> grid_view </span>
                    <h3>Dashboard</h3>
                </a>
                <a th:href="@{/tambahpekerjaan}">
                    <span class="material-symbols-sharp"> add_notes </span>
                    <h3>Tambahkan Pekerjaan</h3>
                </a>

                <a th:href="@{/pekerjaansaya}">
                    <span class="material-symbols-sharp"> work </span>
                    <h3>Pekerjaan Saya</h3>
                    <span th:if="${acceptedNotifications != null and acceptedNotifications > 0}" class="notif-badge" th:text="${acceptedNotifications}"></span>
                </a>
                <a th:href="@{/message}">
                    <span class="material-symbols-sharp"> message </span>
                    <h3>Pesan</h3>
                </a>
                <a th:href="@{/profile}">
                    <span class="material-symbols-sharp"> account_circle </span>
                    <h3>Profil</h3>
                </a>
                <a href="javascript:void(0)" onclick="openLogoutPopup()">
                    <span class="material-symbols-sharp"> logout </span>
                    <h3>Keluar</h3>
                </a>

            </div>
         </aside>
        <!-- Sidebar sec end -->

<div class="detail-container">

    <h1 class="job-title" th:text="${job.title}"></h1>

    <!-- Job Info -->
    <div class="info-grid">

        <div class="info-box">
            <span class="material-symbols-sharp icon">location_on</span>
            <div>
                <p class="label">Lokasi</p>
                <p class="value" th:text="${job.location}"></p>
            </div>
        </div>

        <div class="info-box">
            <span class="material-symbols-sharp icon">payments</span>
            <div>
                <p class="label">Gaji</p>
                <p class="value" th:text="'Rp. ' + ${job.price}"></p>
            </div>
        </div>

        <div class="info-box">
            <span class="material-symbols-sharp icon"> schedule</span>
            <div>
                <p class="label">Durasi</p>
                <p class="value" th:text="${job.duration}"></p>
            </div>
        </div>

        <div class="info-box">
            <span class="material-symbols-sharp icon">category</span>
            <div>
                <p class="label">Kategori</p>
                <p class="value" th:text="${job.kategori}"></p>
            </div>
        </div>

    </div>

    <h2 class="subtitle">Deskripsi Pekerjaan</h2>
    <p class="job-desc" th:text="${job.description}"></p>

    <!-- <button class="apply-btn">Lamar Pekerjaan</button> -->
    <form th:action="@{'/job/' + ${job.id} + '/apply'}" method="post">
        <button class="apply-btn" type="submit">Lamar Pekerjaan</button>
    </form>


    <!-- Posted By Card -->
    <div class="posted-card">
        <p class="posted-label">Diposting oleh</p>

        <div class="posted-row">
            <div class="avatar">
                <a th:href="@{/profile/{id}(id=${postedBy.id})}">
                    <img th:if="${postedBy.profileImage != null}" th:src="@{'/uploads/' + ${postedBy.profileImage}}" alt="Profil" class="profile-photo-small" />
                    <span th:if="${postedBy.profileImage == null}" class="material-symbols-sharp">account_circle</span>
                </a>
            </div>

            <div class="user-info">
                <h3 th:text="${postedBy.username}"></h3>
            </div>
            <button class="msg-btn"
                    th:onclick="'location.href=\'/job/chat/' + ${postedBy.id} + '\';'">
                Kirim Pesan
            </button>
        </div>
    </div>
</div>

<!-- Popup Notifikasi -->
<div class="popup-overlay" th:if="${successApply}">
    <div class="popup-box">
        <p th:text="${successApply}"></p>
        <button onclick="closePopup()">OK</button>
    </div>
</div>

<!-- LOGOUT CONFIRMATION POPUP -->
<div class="logout-overlay" id="logoutPopup" style="display: none;">
    <div class="logout-box">
        <h3>Apa kamu yakin ingin keluar?</h3>

        <div class="logout-actions">
            <button class="btn-yes" onclick="confirmLogout()">Ya</button>
            <button class="btn-no" onclick="closeLogoutPopup()">Tidak</button>
        </div>
    </div>
</div>

<script>
function closePopup() {
    document.querySelector('.popup-overlay').style.display = 'none';
}

function openLogoutPopup() {
    document.getElementById("logoutPopup").style.display = "flex";
}
function closeLogoutPopup() {
    document.getElementById("logoutPopup").style.display = "none";
}
function confirmLogout() {
    window.location.href = "/logout"; // arahkan ke endpoint logout
}
</script>


</body>
</html>

<!-- 
    jobdetail.html (Template View)
    Tanggung Jawab: Menampilkan detail pekerjaan lengkap beserta profil job owner dan memungkinkan user melamar ke pekerjaan tersebut.
    Komponen Utama:
    - Sidebar navigasi (sama seperti dashboard untuk konsistensi navigasi).
    - Info box: Lokasi, Gaji, Durasi, Kategori pekerjaan.
    - Deskripsi pekerjaan lengkap.
    - "Posted By" card menampilkan profil job owner dengan foto dan tombol "Kirim Pesan" untuk chat.
    - Tombol "Lamar Pekerjaan" untuk submit aplikasi.
    - Popup notifikasi jika aplikasi berhasil disubmit.
    Fitur:
    - Form POST ke /job/{id}/apply untuk submit aplikasi.
    - Popup overlay untuk menampilkan success/error message.
    - Logout confirmation popup (sama seperti halaman lain).
    SOLID Principles:
    - Single Responsibility: Template fokus pada presentasi job detail dan form aplikasi, business logic di controller.
    - Reusable JavaScript: Fungsi logout (openLogoutPopup, closeLogoutPopup, confirmLogout) digunakan di semua halaman dengan sidebar.
-->
